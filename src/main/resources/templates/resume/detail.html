<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security" layout:decorate="~{layouts/layout}">

<div layout:fragment="content" class="container my-3">
    <h2 class="text-center my-4 fw-bold text-uppercase" style="letter-spacing: 0.1em;">이 력 서</h2>

    <div class="row mb-5">
        <!-- Profile Image -->
        <div class="col-md-3">
            <div class="border d-flex align-items-center justify-content-center bg-light"
                style="height: 250px; overflow: hidden;">
                <img th:if="${resume.profileImage != null}" th:src="@{${resume.profileImage}}" class="img-fluid"
                    style="max-height: 100%;">
                <span th:if="${resume.profileImage == null}" class="text-muted">사진 없음</span>
            </div>
        </div>

        <!-- Personal Info Table -->
        <div class="col-md-9">
            <h5 class="text-primary fw-bold border-bottom pb-2 mb-3">개인 기본정보</h5>
            <table class="table table-bordered align-middle">
                <colgroup>
                    <col style="width: 15%; background-color: #f8f9fa;">
                    <col style="width: 35%;">
                    <col style="width: 15%; background-color: #f8f9fa;">
                    <col style="width: 35%;">
                </colgroup>
                <tbody>
                    <tr>
                        <th class="text-center">성명</th>
                        <td th:text="${resume.realName}"></td>
                        <th class="text-center">생년월일</th>
                        <td th:text="${resume.dob}"></td>
                    </tr>
                    <tr>
                        <th class="text-center">연락처</th>
                        <td th:text="${resume.phoneNumber}"></td>
                        <th class="text-center">성별</th>
                        <td th:text="${resume.gender}"></td>
                    </tr>
                    <tr>
                        <th class="text-center">이메일</th>
                        <td colspan="3" th:text="${resume.email}"></td>
                    </tr>
                    <tr>
                        <th class="text-center">주소</th>
                        <td colspan="3" th:text="${resume.address}"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Experience -->
    <div class="mb-5">
        <h5 class="text-primary fw-bold border-bottom pb-2 mb-3">경력사항</h5>
        <div class="p-3 bg-light border rounded" style="white-space: pre-wrap;" th:text="${resume.experience}"></div>
    </div>

    <!-- Licenses -->
    <div class="mb-5">
        <h5 class="text-primary fw-bold border-bottom pb-2 mb-3">자격취득사항</h5>
        <div class="p-3 bg-light border rounded" style="white-space: pre-wrap;" th:text="${resume.licenses}"></div>
    </div>

    <!-- Work Conditions -->
    <div class="mb-5">
        <h5 class="text-primary fw-bold border-bottom pb-2 mb-3">희망 근무조건</h5>
        <table class="table table-bordered text-center align-middle">
            <thead class="table-primary">
                <tr>
                    <th>희망급여</th>
                    <th>지원업무</th>
                    <th>근무요일</th>
                    <th>근무시간</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td th:text="${resume.desiredSalary}"></td>
                    <td th:text="${resume.desiredJob}"></td>
                    <td th:text="${resume.workDays}"></td>
                    <td th:text="${resume.workHours}"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Content (Self Intro) -->
    <div class="mb-5">
        <h5 class="text-primary fw-bold border-bottom pb-2 mb-3">자기소개서</h5>
        <div class="card bg-white border-0 shadow-sm">
            <div class="card-body">
                <div class="card-title fw-bold fs-4 mb-3" th:text="${resume.subject}"></div>
                <div class="card-text" style="white-space: pre-wrap;" th:text="${resume.content}"></div>
            </div>
        </div>
    </div>

    <!-- Metadata & Actions -->
    <div class="d-flex justify-content-between align-items-center mb-5 p-3 bg-light rounded">
        <div>
            <span class="fw-bold me-2">작성자:</span>
            <span th:text="${resume.author.username}"></span>
            <span class="mx-2 text-muted">|</span>
            <span class="fw-bold me-2">작성일:</span>
            <span th:text="${#temporals.format(resume.created, 'yyyy-MM-dd HH:mm')}"></span>
        </div>
        <div>
            <a th:href="@{|/resume/modify/${resume.id}|}" class="btn btn-outline-primary me-2"
                sec:authorize="isAuthenticated()"
                th:if="${#authentication.getPrincipal().getUsername() == resume.author.username}">수정</a>
            <a href="javascript:void(0);" th:data-uri="@{|/resume/delete/${resume.id}|}"
                class="delete btn btn-outline-danger" sec:authorize="isAuthenticated()" th:if="${#authentication.getPrincipal().getUsername()
                            == resume.author.username}">삭제</a>
        </div>
    </div>

    <h5 class="border-bottom my-3 py-2" th:text="|${#lists.size(resume.answerList)}개의 답변이 있습니다.|"></h5>

    <div class="card my-3 bg-primary-subtle" th:each="answer : ${resume.answerList}">
        <div class="card-body">
            <div class="card-text" th:text="${answer.content}"></div>
            <div class="d-flex justify-content-end">
                <div class="badge bg-primary text-light p-2 text-start mx-3">
                    <div class="mb-2">
                        <span th:text="${answer.author.username}"></span>
                    </div>
                    <div th:text="${#temporals.format(answer.created, 'yyyy-MM-dd HH:mm')}"></div>
                </div>
            </div>
            <!-- 수정 / 삭제 -->
            <div>
                <a th:href="@{|/answer/modify/${answer.id}|}" class="btn btn-sm btn-outline-primary"
                    sec:authorize="isAuthenticated()"
                    th:if="${#authentication.getPrincipal().getUsername() == answer.author.username}">수정</a>
                <a href="javascript:void(0);" th:data-uri="@{|/answer/delete/${answer.id}|}"
                    class="delete btn btn-sm btn-outline-danger" sec:authorize="isAuthenticated()" th:if="${#authentication.getPrincipal().getUsername()
                                == answer.author.username}">삭제</a>
            </div>
        </div>
    </div>

    <form class="my-3" th:action="@{|/answer/create/${resume.id}|}" method="post" sec:authorize="hasRole('ROLE_SCOUT')">
        <textarea class="form-control" name="content" rows="10"></textarea>
        <input class="btn btn-primary my-3" type="submit" value="답변 제출">
    </form>
</div>
<th:block layout:fragment="script">
    <script type="text/javascript">
        $(document).ready(function () {
            $(".delete").click(function () {
                if (confirm("정말 삭제할까요?")) {
                    const uri = $(this).data('uri');
                    window.location.href = uri;
                }
            })
        });
    </script>
</th:block>

</html>